{% extends 'base.html' %}

{% block title %} Seller-Profile {% endblock %}

{% block content %}
    <style>
        .wrap{
            overflow-wrap: break-word !important;
        }
        .maindiv{
            max-width:450px; border-radius: 15px;
        }
    </style>
    {% include "sellerheader.html" %}

    <main class=" row d-flex flex-column bg-back text-color align-items-center container-fluid  m-0" >
    
        <div class="col bg-light px-3 pb-3 my-3 maindiv" >
            <div class="row   d-flex flex-column justify-content-center align-items-center m-0 ">
                {% if imgdata %}
                    <img src={{imgdata}} alt="" class="p-0 mt-3 mb-2" style="height: 100px; width: 100px; border-radius: 20%; border: 1px solid black;">
                {% else %}
                    <img src="{{url_for('static',filename='images/user.svg')}}" alt="" class="p-0 mt-3 mb-2" style="height: 100px; width: 100px; border-radius: 20%; border: 1px solid black;">
                {% endif %}
                <h3 class="text-center">{{user_data[1]}} {{user_data[2]}}</h3>
                <h6 class="text-center">{{user_data[4]}}</h6>
            </div><br>
            <div class="row">
                <h3 class="text-underline">User info</h3>
                <div class="row d-flex align-items-center justify-content-center">
                    <p class="col-4 m-0 my-2"><b> First Name </b> </p>
                    <p class="col-1 m-0 my-2"><b>:</b></p>
                    <p class="col-6 m-0 my-2 wrap">{{user_data[1]}}</p>
                </div>
                <div class="row d-flex align-items-center justify-content-center">
                    <p class="col-4 m-0 my-2"><b> Last Name </b> </p>
                    <p class="col-1 m-0 my-2"><b>:</b></p>
                    <p class="col-6 m-0 my-2 wrap">{{user_data[2]}}</p>
                </div>
                <div class="row d-flex align-items-center justify-content-center">
                    <p class="col-4 m-0 my-2"><b> Shop Name </b> </p>
                    <p class="col-1 m-0 my-2"><b>:</b></p>
                    <p class="col-6 m-0 my-2 wrap">{{user_data[6]}}</p>
                </div>
                <div class="row d-flex align-items-center justify-content-center">
                    <p class="col-4 m-0 my-2"><b> Email </b> </p>
                    <p class="col-1 m-0 my-2"><b>:</b></p>
                    <p class="col-6 m-0 my-2 wrap">{{user_data[4]}}</p>
                </div>
                <div class="row d-flex align-items-center justify-content-center">
                    <p class="col-4 m-0 my-2"><b> Phone </b> </p>
                    <p class="col-1 m-0 my-2"><b>:</b></p>
                    <p class="col-6 m-0 my-2 wrap">{{user_data[3]}}</p>
                </div>
                <div class="row d-flex align-items-center justify-content-center">
                    <p class="col-4 m-0 my-2"><b> Address </b> </p>
                    <p class="col-1 m-0 my-2"><b>:</b></p>
                    <p class="col-6 m-0 my-2 wrap">{{user_data[5]}}</p>
                </div>
            </div>
            <br>
            <button class="btn w-100 btn-outline-dark w-100" data-bs-toggle="modal" data-bs-target="#login">Edit Profile</button>
            <button class="btn w-100 btn-outline-danger w-100 mt-2" id="deleteAcc">Delete Account</button>
        </div>
        {% include "deleteDiv.html" %}

        <div id="login" class="modal modal-fullscreen text-color">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <div class="modal-title">Atrifusion</div>
                        <button class="btn-close" type="button" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <form action="" id="updatesprofile" enctype="multipart/form-data">
                            <div class=" d-flex align-items-center justify-content-center">
                                <img src={{imgdata}} alt="" id="img" class="rounded-circle bg-info" style="width:100px;height: 100px;"/>
                            </div>
                            <br>
                            <div class="row">
                                <label for="img">Update image</label>
                                <input type="file" id="imageinput" accept="image/*"/>
                              </div>
                              <br>
                            <div class="form-floating mb-3 mt-3">
                                <input type="text" value="{{user_data[1]}}"  class="form-control" id="firstname" placeholder="Enter First Name" name="fname">
                                <label for="name">First Name</label>
                              </div>
                              <div class="form-floating mb-3 mt-3">
                                <input type="text" value="{{user_data[2]}}" class="form-control" id="lastname" placeholder="Enter Last Name" name="lname">
                                <label for="last">Last Name </label>
                              </div>
                              <div class="form-floating mb-3 mt-3">
                                <input type="text" value="{{user_data[6]}}" class="form-control" id="shop" placeholder="Enter Your Shop Name" name="shop">
                                <label for="last">Shop Name </label>
                              </div>
                              <div class="form-floating mt-3 mb-3">
                                <input type="text"  class="form-control"    id="pwd" placeholder="Enter password" name="pswd">
                                <label for="pwd">Enter new Password</label>
                              </div>
                              <div class="form-floating mt-3 mb-3">
                                <input type="tel" value={{user_data[3]}} class="form-control" id="phoneno" placeholder="Enter phonenumber" name="phoneno">
                                <label for="phoneno">Contact Number</label>
                              </div>
                              <div class="form-floating mt-3 mb-3">
                                <input type="text" value="{{user_data[5]}}" class="form-control"  id="addr" placeholder="Enter Address" name="addr">
                                <label for="addr">Address</label>
                              </div>
                              <button type="submit" class="btn btn-outline-dark w-100" data-bs-dismiss="modal">Update Profile</button>
                          
                        </form>
                    </div>
                </div>
            </div>
        </div>   
        
    </main>

    {% include "modal.html" %}

     <script>

        const deleteDiv=document.getElementById('deleteDiv')
        document.getElementById('divTitle').innerText='Delete Account'
        document.getElementById('divPara').innerText='Are you sure want to delete your account ?'
        document.getElementById('deleteBtn').innerText='Delete Account'

        document.getElementById('divclose').onclick=()=>{
            deleteDiv.style.display='none'
        }
        document.getElementById('cancelDelBtn').onclick=()=>{
            deleteDiv.style.display='none'
        }
        document.getElementById('deleteAcc').onclick=()=>{
            deleteDiv.style.display='flex'
        }
        document.getElementById('deleteBtn').onclick=()=>{
            deleteDiv.style.display='none'
            fetch(`${window.origin}/seller/deleteAccount`,{
                    method:'DELETE',
                    headers:{
                        'Content-Type':'application/json',
                    },
                })
                .then(response=>response.json())
                .then(data=>{
                    //console.log(data);
                    //console.log(data.status_code);    
                    if(data.status_code==200){
                        window.location.href='/logout'
                        displayToast('Account deleted successfully','success')
                    }else{
                        displayToast("Some issue occured in deleting account",'danger')
                    }
                }).catch(err=> {
                    //console.log(err)
                    displayToast("Some issue occured in deleting account",'danger')
                })
        }


        let profimg;  
        const upform=document.getElementById('updatesprofile')
        const imgip= document.getElementById('imageinput');
        const img=document.getElementById('img');
        let formData=new FormData()
        imgip.addEventListener('input',()=>{
          if(imgip.files && imgip.files[0]){
            formData.delete('file')            
            formData.append('file',imgip.files[0])

            const reader =new FileReader();
            reader.onload= function(e){
              //console.log(typeof e.target.result);
    
              img.src=e.target.result;
              profimg=e.target.result;
              //console.log(profimg);
              
            };
            reader.readAsDataURL(imgip.files[0])
          }
          //console.log(profimg);
        })
        profimg=img.src;

          
        upform.addEventListener('submit',()=>{
            event.preventDefault()
            //console.log(profimg);
    
            const fname=document.getElementById('firstname').value
            const lname=document.getElementById('lastname').value
            const addr=document.getElementById('addr').value
            const phoneno=document.getElementById('phoneno').value
            const pwd=document.getElementById('pwd').value
            const shop=document.getElementById('shop').value
            
            //console.log('profimg = ',profimg);
            /*
            const newprod={
                fname:fname,
                lname:lname,
                addr:addr,
                phone:phoneno,
                pwd:pwd,
                shop:shop,
                pimgarr:profimg,
            }
            */
            formData.append('fname',fname)
            formData.append('lname',lname)
            formData.append('addr',addr)
            formData.append('phone',phoneno)
            formData.append('pwd',pwd)
            formData.append('shop',shop)
            
            
            /*
            if(npname!=''&& npdesc!='' && npprice!='' && npqty>0 && imgarr.length>=1){
                alert('success') 
                alert(srcarr[0])
                //console.log(srcarr[0]);
                //console.log(newprod);
              */    
                fetch(`${window.origin}/seller/userprofile/edit`,{
                    method:'POST',
                    /*
                    headers:{
                        'content-Type':'application/json',
                    },
                    */
                    body:formData,
                })
                .then(response=>response.json())
                .then(data=>{
                    if(data.status_code==200){
                        //window.location.href='/seller/products'
                        displayToast('Profile info updated successfully','success')
                        location.reload()
                    }else if(data.status_code==404){
                        displayToast('the json data is not received has some problem','danger')
                        window.location.href='/seller/products'
                    }else{
                        displayToast('Some error occured in updating profile','danger')
                        window.location.href='/seller/products'
                    }
                }).catch(error=>{
                    displayToast('Some error occured in updating profile','danger')    
                })      
          /*  }
            else{
                alert('please fill out the necessary details')
            }*/
        })
            
     </script>
{% endblock %}
